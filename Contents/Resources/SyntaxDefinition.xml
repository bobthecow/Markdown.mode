<?xml version="1.0" encoding="UTF-8"?>
<syntax>
	<head>
		<name>Markdown BR</name>
		<charsintokens><![CDATA[_0987654321abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ@]]></charsintokens>
	</head>

	<states>
		<default id="Base" scope="meta.default" usespellchecking="yes">

			<state id="Tags" casesensitive="no" scope="markup.tag">
				<begin><regex>^[ \t]*#</regex></begin>
				<end><regex>[\n\r]</regex></end>
			</state>

			<keywords id="Tag Line" casesensitive="no" scope="markup.tag.attribute.name">
				<regex>^(-{3,})(?=[ \t]*[\r\n]|$)</regex>
			</keywords>

			<state name="Quote" casesensitive="no" scope="style.value.string.double">
				<begin><regex>^[ \t]*&gt;</regex></begin>
				<end><regex>[\n\r]</regex></end>
			</state>

			<keywords id="Strike" casesennsitive="no" scope="markup.tag.attribute.value.string">
				<regex>(~~(?!\s).+?(?!\s)~~)</regex>
			</keywords>

			<state id="Code" type="string" scope="string.single.backtick" usespellchecking="no">
				<begin><regex>`</regex><autoend>`</autoend></begin>
				<end><regex>(((?&lt;!\\)(\\\\)*)|^)`</regex></end>
			</state>

			<keywords id="List Delimiters" scope="markup.tag.attribute.list">
				<regex>^[ \t]*([*+-])[ \t]</regex>
				<regex>^[ \t]*([0-9]+\.)[ \t]</regex>
			</keywords>

			<keywords id="Horizontal Rule" scope="markup.tag.attribute.rule">
				<regex>^(---|\*\*\*|___)\s*[\r\n]|$</regex>
			</keywords>

			<keywords id="Emphasis" scope="markup.tag.attribute.emphasis">
				<regex>(\*\*[^\*\r\n]+?\*\*)</regex>
				<regex>(\*[^\*\r\n]+?\*)</regex>
				<regex>(__[^_\r\n]+?__)</regex>
				<regex>(_[^_\r\n]+?_)</regex>
			</keywords>

			<state id="Image" scope="string.symbol" usespellchecking="no">
				<begin><regex>\!\[</regex></begin>
				<end><regex>\]</regex></end>
			</state>

			<state id="Link Name" scope="string.symbol" usespellchecking="no">
				<begin><regex>\[</regex></begin>
				<end><regex>\]</regex></end>
				<state-link state="Image"/>
			</state>

			<keywords name="Link Name 2" scope="markup.tag.attribute.name" usespellchecking="no">
				<regex>\[(.*?)\]:</regex>
			</keywords>

			<keywords name="Link" scope="meta.link" usespellchecking="no">
				<regex>(?&lt;=\])\(([^\r\n\)]*)\)</regex>
				<regex>(?&lt;=\])\[([^\r\n\]]*)\]</regex>
			</keywords>

			<keywords name="Link 2" scope="meta.link" usespellchecking="no">
				<regex>(?&lt;=\]:)[ \t]*([^\r\n]*)</regex>
			</keywords>

			<state id="Included YAML" scope="markup.tag.attribute.value" usespellchecking="no" >
				<begin><regex>^[-]{3}</regex></begin>
				<end><regex>[-]{3}$</regex></end>

				<keywords id="Keywords" casesensitive="no" scope="markup.tag.attribute.name">
					<regex>^(.*?):</regex>
				</keywords>

				<state id="Comment" scope="style.comment.block">
					<begin><regex>#</regex></begin>
					<end><regex>[\n\r]</regex></end>
				</state>

				<state id="String" scope="style.value.string.double">
					<begin><regex>"</regex></begin>
					<end><regex>(?&lt;!\\)(\\\\)*"</regex></end>
				</state>

				<state id="SingleString" scope="style.value.string.single">
					<begin><string>'</string></begin>
					<end><regex>(?&lt;!\\)(\\\\)*'</regex></end>
				</state>
			</state>
		</default>
	</states>
</syntax>
